<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />

		<title>CookGAN</title>
		<meta name="description" content="The AI for cooking!">
		
		<!-- Google / Search Engine Tags -->
		<meta itemprop="name" content="CookGAN">
		<meta itemprop="description" content="The AI for cooking!">
		<meta itemprop="image" content="http://foodai.cs.rutgers.edu/static/images/card.png">
		
		<!-- Facebook Meta Tags -->
		<meta property="og:url" content="http://foodai.cs.rutgers.edu">
		<meta property="og:type" content="website">
		<meta property="og:title" content="CookGAN">
		<meta property="og:description" content="The AI for cooking!">
		<meta property="og:image" content="http://foodai.cs.rutgers.edu/static/images/card.png">
		<!-- Twitter Meta Tags -->
		<meta name="twitter:card" content="summary_large_image">
		<meta name="twitter:title" content="CookGAN">
		<meta name="twitter:description" content="The AI for cooking!">
		<meta name="twitter:image" content="http://foodai.cs.rutgers.edu/static/images/card.png">
		
		<!--location for flask server -->
		<link rel="stylesheet" href="static/css/cssfile1.css" />
		<link rel="shortcut icon" href="static/assets/favicon.ico" type="image/x-icon">
		<!-- actual relative position -->
		<link rel="stylesheet" href="css/cssfile1.css" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.6/css/selectize.css" />
		<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
		 crossorigin="anonymous"></script>
		<script src="https://cdn.bootcdn.net/ajax/libs/selectize.js/0.12.6/js/standalone/selectize.js"></script>

	</head>
	<body>

			<div class="header_div">
				<label style="height: 30px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CookGAN</label>	
				<label style="height: 30px;float: right;font-weight: normal;"> fh199@cs.rutgers.edu&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
				<label style="height: 30px;float: right;">Contact:&nbsp;</label>
			</div>
			<div style="margin-top: 10px;"></div>
		<h1 align="center">CookGAN: Meal Image Sythesis from Ingredients</h1>
<table align="center">

  <tr>
    <td><a href='http://seqamlab.com/fangda-han/', target='_blank'>Fangda Han</a>,&nbsp;</td>
    <td><a href='https://scholar.google.com/citations?user=bn2TAy8AAAAJ&hl=en', target='_blank'>Ricardo Guerrero</a>,&nbsp;</td>
	<td><a href='http://seqamlab.com/vladimir-pavlovic/', target='_blank'>Vladimir Pavlovic</a></td>
  </tr>
</table>
		<div class="bigdiv" >
			<h2 align="center">Gallery</h3>
			<h4 style="font-weight:normal;"align="center">Explore our existing gallery of dishes -- real ones, and synthetic ones</h4>
			<div style="text-align:center">
			<button onclick="example_dish()" style="width: 200px;">Get a random dish!</button>
			</div>
			<table align="center" style=" font-size: 16px;boarder-spacing:50px 100px">
				<div style="margin-top: 20px;"></div>
				<tr>
					<td align="center"  >Real Photo &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
					<td align="center">Synthetic Image</td>
				</tr>
				<tr>
					<td><img id="example_real_image" style="margin-right:40px;width:256px;height:256px;margin-top: 10px;border-radius: 15px;"/></td>
					<td><img id="example_fake_image"style="width:256px;height:256px;margin-top: 10px;border-radius: 15px;"/></td>
				</tr>
			</table>
			<div id="example_label_div" align="center" style="width: 90%;">
			</div>
		</div>
			<div class="bigdiv">
				<h2 align="center">Make Your Own Dish</h3>
				　　<form>
					<label style="font-weight: bold">Food type:</label>
					　　<input id="salad_ratio" onclick="food_type_ratio_onclick()" type="radio" name="food_type_ratio" value="salad" >salad
					　　<input id="cookie_ratio" onclick="food_type_ratio_onclick()" type="radio" name="food_type_ratio" value="cookie">cookie
					　　<input id="muffin_ratio" onclick="food_type_ratio_onclick()" type="radio" name="food_type_ratio" value="muffin">muffin
				</form>
				<br/>

				<label style="font-weight: bold">What's on your plate?</label>
				<div style="margin-bottom: 6px;"></div>
				<select id="plate" class="mytextbox" style="margin-top: 30px;">
					<option value=""></option>

				</select>
				<div style="text-align:center">
					<button onclick="cook_plate()" id="synthesize_button">Synthesize</button>
					<button onclick="feel_lucky()">Feel Lucky</button>
				</div>
				<div id="generate_image_div" class="picdiv">


				</div>
<div align="center">
				<label style="font-weight: bold">Do you think this image is a real dish?</label>
<div style="margin-bottom: 14px;"></div>
<input class="number_radio" type="radio" name="rating_ratio" value="1">Kidding me? Not at all!&nbsp;&nbsp;

<input class="number_radio" type="radio" name="rating_ratio" value="2">Doesn't seem real&nbsp;&nbsp;
<input class="number_radio" type="radio" name="rating_ratio" value="3">Maybe, I can't tell&nbsp;&nbsp;
<input class="number_radio" type="radio" name="rating_ratio" value="4">It seems real&nbsp;&nbsp;
<input class="number_radio" type="radio" name="rating_ratio" value="5">It is so real!&nbsp;&nbsp;
<div style="margin-top: 5px;"></div>
				<button id="rating_button" onclick="submit_rating()" value="Tell them!"></button>
</div>
			</div>
			<div class="bigdiv" ,align="center">
				<div style="margin-top: 15px;"></div>
				<h2 align="center">Behind the Image</h3>
				<div style="margin-top: 10px;"></div>
				<table align="center" style="width:80%;font-weight: bold; font-size: 24px;">
					<tr>
						<td width="100px"align="center"><a href='http://openaccess.thecvf.com/content_WACV_2020/papers/Han_CookGAN_Meal_Image_Synthesis_from_Ingredients_WACV_2020_paper.pdf', target='_blank'> Paper</a></td>
						<td width="100px"align="center"><a href='https://arxiv.org/abs/2002.11493', target='_blank'> Arxiv</a></td>
						<td width="100px"align="center"><a href='http://seqamlab.com/2020/02/24/cookgan-meal-image-synthesis-from-ingredients/', target='_blank'> Review1</a></td>
						<td width="100px"align="center"><a href='https://medium.com/syncedreview/cookgan-generates-realistic-meal-images-from-an-ingredients-list-250426dbfab2', target='_blank'> Review2</a></td>
					</tr>
				</table>
<div style="margin-top: 30px;"></div>
				<div align="center"><iframe width="600" height="400"
				src="http://www.youtube.com/embed/0jsteoeuZQY"></iframe></div>
				
				<h4 style="margin-bottom: 5px;">Motivation</h4>
				<label>Synthesizing photo-realistic food meal images from textual descriptions of its ingredients.</label>
				<h4 style="margin-bottom: 5px;">Methodology</h4>
				<label>The framework first builds an attention-based ingredients-image association model, which is then used to condition a generative neural network tasked with synthesizing meal images.
				 Furthermore, a cycle-consistent constraint is added to further improve image quality and control appearance.
				 Preliminary experiments show our model is able to generate meal image corresponding to the ingredients list.</label>
				<img id="model_image" style="width: 100%;height:auto"/>
				<h4 style="margin-bottom: 5px;">Potential Applications</h4>
				<label>Beyond its ability to help understand the relationship between two domains (i.e. natural languange and vision), a well trained model also has other applications, to name a few, Text visualization, Data augmentation, Cooking skill learning.</label>
			</div>
<div class="header_div">

				<label style="height: 25px;float: right;font-size: 14px;"> Thanks to <a style='color: #FFFFFF;font-size: 14px;' href="https://www.linkedin.com/in/guoyao-hao-138207138/">Guoyao Hao</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
			</div>

	</body>

	<script>
		var ingredients = {}
		var plate = null
		var available_example = []
		var example_number = -1
		var generated_image_name = ""
		var food_type = "salad"
		//var serveraddress = 'http://127.0.0.1:5000/'
		var serveraddress = "http://foodai.cs.rutgers.edu/"
		$(document).ready(function() {
			$("#model_image").attr('src', serveraddress + "static/model.svg");
			// initialize the multiselect dropdown menu 
			var $plate = $('#plate').selectize({
				delimiter: ',',
				create: false,
				maxItems: 8,
			})
			//get the object of the multiselect dropdown
			plate = $plate[0].selectize
			
			//when nothing on the plate, disable the synthesize button
			plate.on("change", function(event) {
				if(plate.items.length==0){
					$("#synthesize_button").attr("disabled", true)
				}else{
					$("#synthesize_button").attr("disabled", false)
				}
			})
			
			//get ingredients of all food types
			$.post(serveraddress + "ingredients",null, success = function(data) {
				ingredients = data
				auto_select()
				refresh_multi_select(food_type)
				feel_lucky()
			});

			
			// get example numbers in the Gallery
			$.ajax({
				type: 'POST',
				url: serveraddress + "example_number",
				contentType: "application/json",
				data: {"id":1},
				success: function(data) {
					example_number = data['number']
					example_dish()
				}
			});
			
			

		})

		//Choosing a different food type
		function food_type_ratio_onclick() {
			plate.clear()
			$("#generate_image_div").empty()
			var radios = document.getElementsByName("food_type_ratio");
			var value = 0;
			for (var i = 0; i < radios.length; i++) {
				if (radios[i].checked == true) {
					food_type = radios[i].value;
				}
			}
			refresh_multi_select(food_type)
			feel_lucky()
		}
		
		// after choosing a different food type, refresh the multiselect dropdown
		function refresh_multi_select(food_type) {
			plate.clearOptions()
			for (i = 0; i < ingredients[food_type].length; i++) {
				plate.addOption({
					value: ingredients[food_type][i]["value"],
					text: ingredients[food_type][i]["value"]
				})
			}
		}
		
		//This function will return users a random dish. But simply chosing two random dishes may return a same one twice.
		//available_example is a list to store examples that haven't been showed
		function example_dish() {
			//if all examples have been displayed for once, add all examples to the list
			if(available_example.length==0){
				for(i=0;i<example_number;i++){
					available_example.push(i)
				}
			}
			//choose a random example from the list and remove it from the list
			var chosen_position = Math.floor(Math.random()*available_example.length)
			var chosen_value =available_example[chosen_position]
			available_example.splice(chosen_position,1)
			$("#example_real_image").attr('src', serveraddress + "static/assets/examples/" + "real"+chosen_value+".png");
			$("#example_fake_image").attr('src', serveraddress + "static/assets/examples/" +"fake"+chosen_value+".png");
			//Aftering getting the image, request igredients from the server.
			$.ajax({
				type: 'POST',
				url: serveraddress + "one_example",
				contentType: "application/json",
				data: JSON.stringify( {
				"number": chosen_value
			}),
				success: function(data) {
				$("#example_label_div").empty()
					$("#example_label_div").append("<label>Ingredients:&nbsp;&nbsp;&nbsp;</label>")
					for(i=0;i<data["ingredients"].length;i++){
					$("#example_label_div").append("<div class='labeldiv'><label class='labelwithboader'>"+data["ingredients"][i]+"</label></div>")
					}
				}
			});
			
		}

		function submit_rating() {
			// if no value selected in the rating ratio, return.
			if($('input[name=rating_ratio]:checked').val()==null){
				return
			}
			$.ajax({
				type: 'POST',
				url: serveraddress + "submit_rating",
				contentType: "application/json",
				data: JSON.stringify({
					"image_name": generated_image_name,
					"feedback": $('input[name=rating_ratio]:checked').val()
				}),
				success: function(data) {
					// after rating , disable the rating button
					document.getElementById("rating_button").innerHTML = "Thanks!";
					$("#rating_button").attr("disabled", true)
				}
			});
		}
		

		//genereate an image using five random ingredients
		function feel_lucky() {
			plate.clear()
			$.ajax({
				type: 'POST',
				url: serveraddress + "random_recipe",
				contentType: "application/json",
				data: JSON.stringify({
					"food_type": food_type
				}),
				success: function(data) {
					for (i = 0; i < data["random_recipe"].length; i++) {
						plate.addOption({
							value: data["random_recipe"][i],
							text:data["random_recipe"][i]
						})
						plate.addItem(data["random_recipe"][i], true)
					}
					cook_recipe(data["random_recipe"])
					$("#synthesize_button").attr("disabled", false)
				}
			});
			
			
			// var array_copy = ingredients[food_type].slice(0)
			// for (i = array_copy.length - 1; i > 0; i--) {
			// 	const j = Math.floor(Math.random() * i)
			// 	const temp = array_copy[i]
			// 	array_copy[i] = array_copy[j]
			// 	array_copy[j] = temp
			// }
			// for (i = 0; i < 5; i++) {
			// 	plate.addItem(array_copy[i]['value'], true)
			// }
			// cook_plate()
			
		}

		function cook_recipe(recipe){
			$.ajax({
				type: 'POST',
				url: serveraddress + "generate_image",
				contentType: "application/json",
				data: JSON.stringify({
					"food_type": food_type,
					"ingredients": recipe
				}),
				success: function(data) {
					//the server will return the name of the generated file, update the view using the file name
					$("#generate_image_div").empty()
					$("#generate_image_div").append("<img id='generated_image' style='width:512px;height:512px;border-radius: 30px;'/>")
					$("#generated_image").attr('src', serveraddress + "static/generated_images/" + data["src"]);
					generated_image_name = data["src"]
					// after generating a new image, enable the rating button
					$("#rating_button").attr("disabled", false)
					$("#rating_button").text("Tell them!");
					$('input[name=rating_ratio]:checked').prop("checked", false);
				}
			});
		}
		//generate an image based on ingredients in the multiselect dropdown and food type
		function cook_plate() {
			var radios = document.getElementsByName("food_type_ratio");
			var value = 0;
			for (var i = 0; i < radios.length; i++) {
				if (radios[i].checked == true) {
					food_type = radios[i].value;
				}
			}
			cook_recipe(plate.items)
		}
		
		function auto_select(){
			
			$("#salad_ratio").removeAttr("checked")
			$("#cookie_ratio").removeAttr("checked")
			$("#muffin_ratio").removeAttr("checked")
			random_number = Math.random()
			if(random_number<0.35){
				$("#salad_ratio").attr("checked", "checked")
				food_type=  "salad"
			}else if(0.35<=random_number &&random_number<0.69){
				$("#cookie_ratio").attr("checked", "checked")
				food_type= "cookie"
			}else{
				$("#muffin_ratio").attr("checked", "checked")
				food_type= "muffin"
			}
		}

	</script>
</html>
